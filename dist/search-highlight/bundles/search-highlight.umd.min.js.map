{"version":3,"sources":["ng://search-highlight/lib/search-highlight.service.ts","ng://search-highlight/lib/components/search-highlight/search-highlight.component.ts","ng://search-highlight/lib/adf.module.ts","ng://search-highlight/lib/search-highlight.module.ts"],"names":["SearchHighlightService","Injectable","args","providedIn","SearchHighlightComponent","store","alfrescoApiService","router","this","onDestroy$","Subject","name$","BehaviorSubject","title$","prototype","ngOnInit","_this","updateValues","nodeUpdated","pipe","takeUntil","subscribe","node","row","context","entry","id","name","properties","Object","assign","search","highlightAll","_a","title","next","forEach","elem","field","snippets","highlight","ngOnDestroy","complete","defineProperty","modifiedAt","content","sizeInBytes","modifiedByUser","displayName","isFile","showPreview","event","stopPropagation","dispatch","ViewNodeAction","location","url","navigate","NavigateToFolder","Component","selector","encapsulation","ViewEncapsulation","None","template","Store","AlfrescoApiService","Router","Input","modules","CoreModule","ToolbarModule","PipeModule","DirectiveModule","AdfModule","NgModule","imports","exports","SearchHighlightModule","declarations","CommonModule","BrowserModule","TranslateModule","forChild","entryComponents","schemas","CUSTOM_ELEMENTS_SCHEMA"],"mappings":"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","sourcesContent":["/*!\n * @license\n * Alfresco Example Content Application\n *\n * Copyright (C) 2005 - 2020 Alfresco Software Limited\n *\n * This file is part of the Alfresco Example Content Application.\n * If the software was purchased under a paid Alfresco license, the terms of\n * the paid license agreement will prevail.  Otherwise, the software is\n * provided under the following open source license terms:\n *\n * The Alfresco Example Content Application is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * The Alfresco Example Content Application is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Alfresco. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchHighlightService {\n\n  constructor() {}\n  \n}\n","/*!\n * @license\n * Alfresco Example Content Application\n *\n * Copyright (C) 2005 - 2020 Alfresco Software Limited\n *\n * This file is part of the Alfresco Example Content Application.\n * If the software was purchased under a paid Alfresco license, the terms of\n * the paid license agreement will prevail.  Otherwise, the software is\n * provided under the following open source license terms:\n *\n * The Alfresco Example Content Application is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * The Alfresco Example Content Application is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Alfresco. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Component, OnInit, Input, ViewEncapsulation, OnDestroy, TemplateRef } from '@angular/core';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { AlfrescoApiService } from '@alfresco/adf-core';\n\nimport { takeUntil } from 'rxjs/operators';\nimport { MinimalNodeEntity } from '@alfresco/js-api';\nimport { Store } from '@ngrx/store';\nimport { Router } from '@angular/router';\nimport { ViewNodeAction, NavigateToFolder } from '@alfresco/aca-shared/store';\n\n\n@Component({\n  selector: 'aca-search-results-row-highlight',\n  encapsulation: ViewEncapsulation.None,\n  templateUrl: './search-highlight.component.html',\n  styleUrls: ['./search-highlight.component.scss']\n})\nexport class SearchHighlightComponent implements OnInit, OnDestroy {\n\n  @Input()\n  context: any;\n\n  @Input()\n  locationField: TemplateRef<any>;\n\n  private node: MinimalNodeEntity;\n  private onDestroy$ = new Subject<boolean>();\n  name$ = new BehaviorSubject<string>('');\n  title$ = new BehaviorSubject<string>('');\n  highlight: [];\n\n  constructor(\n    private store: Store<any>,\n    private alfrescoApiService: AlfrescoApiService,\n    private router: Router\n    ) { }\n\n  ngOnInit() {\n    \n    this.updateValues();\n\n    this.alfrescoApiService.nodeUpdated\n      .pipe(takeUntil(this.onDestroy$))\n      .subscribe((node: any) => {\n        const row = this.context.row;\n        if (row) {\n          const { entry } = row.node;\n\n          if (entry.id === node.id) {\n            entry.name = node.name;\n            entry.properties = Object.assign({}, node.properties);\n            entry.search = Object.assign({}, node.search);\n            this.updateValues();\n          }\n        }\n      });\n  }\n\n  private updateValues() {\n\n    this.node = this.context.row.node;\n\n    const highlightAll = (this.node.entry['search'] && this.node.entry['search']['highlight']) ? this.node.entry['search']['highlight'] : [];\n\n    const { name, properties } = this.node.entry;\n    const title = properties ? properties['cm:title'] : '';\n\n    this.name$.next(name);\n\n    if (title !== name) {\n      this.title$.next(title ? `( ${title} )` : '');\n    }\n\n    highlightAll.forEach(elem => {\n      if (elem.field === \"cm:name\") {\n        this.name$.next(elem.snippets[0]);\n      }\n\n      if (elem.field === \"cm:title\" && title !== name) {\n        this.title$.next(`( ${elem.snippets[0]} )`);\n      }\n\n      if (elem.field === \"cm:content\") {\n        this.highlight = elem.snippets;\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.onDestroy$.next(true);\n    this.onDestroy$.complete();\n  }\n\n  get description(): string {\n    const { properties } = this.node.entry;\n    return properties ? properties['cm:description'] : '';\n  }\n\n  get modifiedAt(): Date {\n    return this.node.entry.modifiedAt;\n  }\n\n  get size(): number {\n    const { content } = this.node.entry;\n    return content ? content.sizeInBytes : null;\n  }\n\n  get user(): string {\n    return this.node.entry.modifiedByUser.displayName;\n  }\n\n  get isFile(): boolean {\n    return this.node.entry.isFile;\n  }\n\n  showPreview(event: MouseEvent) {\n    event.stopPropagation();\n    this.store.dispatch(\n      new ViewNodeAction(this.node.entry.id, { location: this.router.url })\n    );\n  }\n\n  navigate(event: MouseEvent) {\n    event.stopPropagation();\n    this.store.dispatch(new NavigateToFolder(this.node));\n  }\n}\n","/*!\n * @license\n * Alfresco Example Content Application\n *\n * Copyright (C) 2005 - 2020 Alfresco Software Limited\n *\n * This file is part of the Alfresco Example Content Application.\n * If the software was purchased under a paid Alfresco license, the terms of\n * the paid license agreement will prevail.  Otherwise, the software is\n * provided under the following open source license terms:\n *\n * The Alfresco Example Content Application is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * The Alfresco Example Content Application is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Alfresco. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { NgModule } from \"@angular/core\";\n// ADF modules\nimport {\n  CoreModule,\n  PipeModule,\n  ToolbarModule,\n  DirectiveModule\n} from '@alfresco/adf-core';\n\nexport function modules() {\n  return [CoreModule, ToolbarModule, PipeModule, DirectiveModule];\n}\n\n@NgModule({\n  imports: modules(),\n  exports: modules()\n})\nexport class AdfModule {\n\n}\n","/*!\n * @license\n * Alfresco Example Content Application\n *\n * Copyright (C) 2005 - 2020 Alfresco Software Limited\n *\n * This file is part of the Alfresco Example Content Application.\n * If the software was purchased under a paid Alfresco license, the terms of\n * the paid license agreement will prevail.  Otherwise, the software is\n * provided under the following open source license terms:\n *\n * The Alfresco Example Content Application is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * The Alfresco Example Content Application is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Alfresco. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { SearchHighlightComponent } from './components/search-highlight/search-highlight.component';\nimport { CommonModule } from '@angular/common';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { AdfModule } from './adf.module';\n\n@NgModule({\n  declarations: [SearchHighlightComponent],\n  imports: [CommonModule, BrowserModule, TranslateModule.forChild(), AdfModule],\n  exports: [SearchHighlightComponent],\n  entryComponents: [SearchHighlightComponent],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\n})\nexport class SearchHighlightModule { }\n"]}